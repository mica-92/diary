<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>dainandinī</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 640'><path d='M201.7 291.5C236 310.2 266.2 335.6 290.5 366C301.6 379.9 311.5 394.9 319.9 410.8C328.4 394.9 338.2 380 349.3 366C373.6 335.5 403.8 310.1 438.1 291.5C479.8 268.8 527.5 256 577.8 256L587.7 256C598.8 256 607.8 265 607.8 276.1C607.8 424.1 487.9 544 339.9 544L299.7 544C151.9 544 32 424.1 32 276.1C32 265 41 256 52.1 256L62 256C112.4 256 160.1 268.8 201.7 291.5zM335.9 102C352.8 117.9 397.3 165.4 424.9 244.3C384.8 264.5 349.1 292.5 320 326.4C290.8 292.5 255.2 264.6 215.1 244.3C242.7 165.4 287.3 117.9 304.1 102C308.4 97.9 314.1 96 320 96C325.9 96 331.6 98 335.9 102z'/></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cardo:ital,wght@0,400;0,700;1,400&family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Inconsolata:wght@200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Incluir Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root {
            /* Colores base */
            --bck: #a6b39a;
            --primary-color: #515b4470;
            --accent-color: #515b44;
            --border-color: #fff7ccff;
            --hover-color: #333333;
            --text-dark: #333333;
            --text-light: #ffffff;
            --yellow-accent: #f8dc3dff;
            --red-accent: #f6442fff;
            --blue-accent: #2f49f6ff;
            
            /* Filtros de imagen por sección */
            --study-hue: 170deg;
            --lexicon-hue: 120deg;
            --lexicon-list-hue: 120deg;
            --log-hue: 220deg;
            --log-accent: #515b44;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Inconsolata", monospace;
        }

        .chart-mood-circle {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid var(--text-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    font-size: 0.9rem;
}

        /* Header fijo */
        header {
            padding: 8px 20px;
            color: var(--bck);
            text-align: center;
            font-weight: bold;
            border-bottom: 3px solid var(--text-dark);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--accent-color);
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            background-color: var(--bck);
            line-height: 1.4;
            display: flex;
            flex-direction: column;
            color: #333;
        }

        /* Contenedor principal con scroll */
        .app-container {
            display: flex;
            flex-direction: column;
            height: 100dvh;
            padding-top: 60px;
            padding-bottom: 70px;
        }

        .content {
            flex: 1;
            overflow-y: auto;
            width: 100%;
        }

        main {
            margin: 0 auto;
            max-width: 100%;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Barra de navegación fija */
        .nav-bar {
            position: fixed;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #6d765f;
            border-top: 3px solid var(--text-dark);
            z-index: 1000;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 8px;
        }

        .nav-menu {
            display: flex;
            width: 100%;
            height: 100%;
        }

        .nav-btn {
            flex: 1;
            background: #6d765f;
            border: none;
            border-right: 1px solid var(--text-dark);
            color: var(--text-dark);
            padding: 12px 5px;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.7rem;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
        }

        .nav-btn:last-child {
            border-right: none;
        }

        .nav-btn.active {
            background: var(--accent-color);
            color: var(--bck);
        }

        .nav-btn:hover {
            background: var(--yellow-accent);
            color: var(--text-dark);
        }

        .nav-btn i {
            font-size: 1rem;
        }

        /* Estilos para la bitácora */
        .log-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }

        /* HEADER CON FECHA Y BOTONES CIRCULARES */
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 2px solid var(--text-dark);
        }

        .log-date {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-dark);
            flex: 1;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid var(--text-dark);
            background: var(--log-accent);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .header-btn:hover {
            background: var(--yellow-accent);
            color: var(--text-dark);
        }

        /* SECCION */

        .detail-label {
            text-align: center;
            padding: 6px;
            font-weight: bold;
            border-bottom: 2px solid #33333380;
        }

        .notes-section {
            padding: 12px;
            border-bottom: 2px solid #333;
        }

        .date-input-container {
            margin-bottom: 15px;
        }

        .date-input-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-dark);
        }

        .date-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid var(--text-dark);
            background: rgba(233, 165, 106, 0.4);
            color: var(--text-dark);
            font-family: "Inconsolata", monospace;
        }

        .notes-textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 2px solid var(--text-dark);
            background: rgb(233, 196, 106);
            font-family: "Inconsolata", monospace;
            resize: vertical;
        }

        /* TAGS SECTION */
        .tags-section {
            padding: 12px;
            border-bottom: 2px solid #333;
        }

        .tags-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            margin-top: 12px;
        }

        .tag-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid var(--text-dark);
            background: rgba(233, 165, 106, 0.4);
            color: var(--text-dark);
        }

        .add-tag-btn {
            background: var(--log-accent);
            color: white;
            border: 2px solid var(--text-dark);
            padding: 0;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .add-tag-btn:hover {
            background: var(--yellow-accent);
            color: var(--text-dark);
        }

        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding-bottom: 12px;
        }

        .tag {
            display: inline-block;
            background: var(--accent-color);
            border: 2px solid var(--text-dark);
            padding: 5px 10px;
            font-size: 0.9rem;
            border-radius: 4px;
            text-transform: uppercase;
            color: #fff;
        }

        /* ASANAS SECTION */
        .asanas-section {
            padding: 12px;
            border-bottom: 2px solid #333;
        }

        .asanas-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .asana-input {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid var(--text-dark);
            color: var(--text-dark);
            background-color: rgba(233, 165, 106, 0.4);
        }

        .add-asana-btn {
            background: var(--log-accent);
            color: white;
            border: 2px solid var(--text-dark);
            padding: 0;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .add-asana-btn:hover {
            background: var(--yellow-accent);
            color: var(--text-dark);
        }

        .asanas-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .asana-tag {
            display: inline-block;
            background: var(--accent-color);
            border: 2px solid var(--text-dark);
            color: #fff;
            padding: 5px 10px;
            font-size: 0.9rem;
            border-radius: 4px;
            text-transform: uppercase;
        }

        .asana-search-results {
            max-height: 150px;
            overflow-y: auto;
            border: 2px solid var(--text-dark);
            background: var(--primary-color);
            margin-top: 8px;
        }

        .asana-search-result {
            padding: 8px 10px;
            border-bottom: 1px solid var(--text-dark);
            cursor: pointer;
        }

        .asana-search-result:hover {
            background: rgba(47, 139, 246, 0.2);
        }

        .asana-search-result:last-child {
            border-bottom: none;
        }

        .log-history {
            margin-top: 12px;
            border-top: 2px solid #333;
            background-color: #515b4470;
            padding-bottom: 20px; /* Añadir padding en la parte inferior del historial */

            
        }

        .log-history h3 {
            padding: 12px;
            background: rgb(188, 71, 73); 
            text-align: left;
            margin-bottom: 8px;
            border-bottom: 2px solid #333;
        }

        .log-entry {
            margin: 15px;
            padding: 15px;
            background: rgba(153, 143, 118, 0.4);
            border: 1px solid #333333;
        }

        .log-entry-header {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
            padding-bottom: 5px;
        }

        .log-entry-date {
            font-weight: bold;
            text-transform: capitalize;
            width: 100%;
        }

        .log-entry-moods {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .log-entry-mood {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 1px solid var(--text-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .log-entry-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }

        .log-entry-tag {
            background: rgba(47, 139, 246, 0.2);
            border: 1px solid var(--text-dark);
            padding: 3px 8px;
            font-size: 0.8rem;
        }

        .log-entry-notes {
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.3);
                }

        /* Botón de eliminar */
        .delete-entry-btn {
            background: var(--red-accent);
            color: white;
            border: 2px solid var(--text-dark);
            padding: 5px 10px;
            cursor: pointer;
            font-weight: bold;
            border-radius: 4px;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .delete-entry-btn:hover {
            background: #d63031;
            color: var(--text-dark);
        }

        /* MOOD SECTION - BOTÓN DE PRÁCTICA COMO UN MOOD MÁS */
        .mood-section {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 2px solid #33333380;
            gap: 10px;
        }

        .practice-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .practice-button {
            width: 33px;
            height: 33px;
            background-color: var(--red-accent);
            border: 2px solid var(--text-dark);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .practice-state {
            font-weight: bold;
            color: var(--text-dark);
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .practice-button.yes {
            background-color: var(--accent-color);
        }

        .practice-button.yes .practice-state {
            color: var(--text-light);
        }

        .mood-board {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            flex: 1;
        }

        .mood-item {
            width: 33px;
            height: 33px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--text-dark);
            border-radius: 50%;
            background-color: #ccc;
            margin: 2px;
        }

        .mood-item.selected {
            transform: scale(1.1);
            filter: hue-rotate(90deg);
            color: #505749;
        }

        /* Para el historial - mismo estilo */
        .log-entry-practice {
            width: 30px;
            height: 30px;
            background-color: var(--red-accent);
            border: 2px solid var(--text-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin: 2px;
        }

        .log-entry-practice.yes {
            background-color: var(--accent-color);
        }

        .log-entry-practice .practice-state {
            color: var(--text-dark);
            font-weight: bold;
            font-size: 0.8rem;
        }

        .log-entry-practice.yes .practice-state {
            color: var(--text-light);
        }

        .log-entry-moods {
            display: flex;
            flex-wrap: wrap;
            gap: 7px;
            align-items: center;
            max-width: 100%;
            margin: 2px;
        }

        /* Para pantallas pequeñas */
        @media (max-width: 767px) {
            .mood-section {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .practice-toggle {
                order: -1; /* Poner primero */
            }
            
            .mood-board {
                justify-content: flex-start;
            }

            header {
                font-size: 0.8rem !important;
            }
        }

        @media (max-width: 480px) {
            .mood-board {
                gap: 4px;
            }
            
            .mood-item, .practice-button {
                width: 30px;
                height: 30px;
            }
            
            .practice-state {
                font-size: 0.7rem;
            }
        }

        /* Indicador de modo edición */
        .log-header.editing::before {
            content: "EDITANDO ENTRADA EXISTENTE";
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--yellow-accent);
            color: var(--text-dark);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            border: 2px solid var(--text-dark);
            z-index: 100;
        }

        .log-header {
            position: relative;
        }

        .save-log-btn.editing {
            background: var(--yellow-accent) !important;
            color: var(--text-dark) !important;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* ESTADÍSTICAS */
        .stats-section {
            background: #515b4470;
            margin-top: 10px
        }

        .stats-title {
            text-align: left;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: var(--text-dark);
            background: rgb(188, 71, 73);
            padding: 12px;
            border-top: 2px solid #333;
            border-bottom: 2px solid #333;

        }

        .stats-summary {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .stats-chart {
            width: 100%;
            height: 250px;
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            gap: 5px;
            padding: 10px;
            padding-bottom: 40px;
            border-bottom: 2px solid #333;
        }

        .chart-bar {
            flex: 1;
            background: var(--accent-color);
            border: 1px solid var(--text-dark);
            position: relative;
            min-height: 5px;
            transition: all 0.3s ease;
        }

        .chart-bar:hover {
            background: var(--yellow-accent);
        }

        .chart-label {
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.7rem;
            color: var(--text-dark);
        }

        .chart-value {
            position: absolute;
            top: -20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.7rem;
            font-weight: bold;
            color: var(--text-dark);
        }

        .log-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--text-dark);
    flex: 1;
    text-align: left;
}





    </style>
</head>

<body>
    <header>
        <div style="font-size: 1.1rem;">Dainandinī</div>
        <div style="font-size: 0.9rem;"><br>una bitácora para la práctica del yoga</div>
    </header>
    
    <div class="app-container">
        <div class="content">
            <main>
                <div class="detail-label" style="background: rgb(233, 196, 106);">desarrollado por una ashtangui</div>                      

                <!-- Nueva sección Bitácora -->
                <section id="log" class="section active" style="margin:10px; ">
                    <div class="log-container" style="border: 2px solid #333">
                        <div class="log-header" style="background: rgb(188, 71, 73)">
                            <div class="log-date" id="current-date" style="display: none;">DD/MM/YYYY</div>
                            <div class="log-title">NUEVO Registro</div>
                            <div class="header-actions">
                                <button class="header-btn" id="save-log-btn" title="Guardar">
                                    <i class="fa-solid fa-floppy-disk"></i>
                                </button>
                                <button class="header-btn" id="clear-log-btn" title="Limpiar">
                                    <i class="fa-solid fa-rotate-left"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="mood-section" style="background: #33333330;">
                            <div class="practice-toggle">
                                <div class="practice-button" id="practice-button">
                                    <div class="practice-state">NO</div>
                                </div>
                            </div>
                            <div class="mood-board" id="mood-board">
                                <!-- Los elementos del mood board se generarán con JavaScript -->
                            </div>
                        </div>

                        <!-- SECCIÓN NOTAS -->
                        <div class="notes-section" style="background: #33333330;">
                            <div class="date-input-container">
                                <label class="date-input-label" for="practice-date">FECHA DE LA PRÁCTICA:</label>
                                <input type="date" class="date-input" id="practice-date">
                                <small style="color: #666; font-size: 0.8rem;">Si está vacío, se usará la fecha actual</small>
                            </div>
                            
                            <textarea class="notes-textarea" id="practice-notes" placeholder="Escribe tus notas aquí..."></textarea>

                            <div class="tags-input">
                                <input type="text" class="tag-input" id="tag-input" placeholder="Vincular etiquetas...">
                                <button class="add-tag-btn" id="add-tag-btn">+</button>
                            </div>
                            <div class="tags-list" id="tags-list">
                                <!-- Los tags se mostrarán aquí -->
                            </div>
                        
                            <div class="asanas-input">
                                <input type="text" class="asana-input" id="asana-search-input" placeholder="Vincular āsana...">
                                <button class="add-asana-btn" id="add-asana-btn">+</button>
                            </div>
                            <div class="asana-search-results" id="asana-search-results" style="display: none;">
                                <!-- Los resultados de búsqueda aparecerán aquí -->
                            </div>
                            <div class="asanas-list" id="asanas-list">
                                <!-- Los āsanas vinculados se mostrarán aquí -->
                            </div>
                        </div>
                        
                        <!-- ESTADÍSTICAS -->
                        <div class="stats-section">
                            <div class="stats-title">ESTADÍSTICAS la práctica</div>
                            <div class="stats-summary" id="stats-summary">
                                <!-- Las estadísticas se mostrarán aquí -->
                            </div>
                            <div class="stats-chart" id="stats-chart">
                                <!-- El gráfico se generará aquí -->
                            </div>
                        </div>
                        
                        <!-- HISTORIAL -->
                        <div class="log-history" id="log-history">
                            <h3>REGISTRO de prácticas</h3>
                            <!-- Las entradas anteriores se mostrarán aquí -->
                        </div>
                    </div>
                </section>
                
                <!-- Otras secciones... -->
                <section id="study" class="section">
                    <div style="text-align: center; padding: 50px;">
                        <h2>SECCIÓN DE ESTUDIO</h2>
                        <p>Contenido de estudio aparecerá aquí</p>
                    </div>
                </section>
                
                <section id="list" class="section">
                    <div style="text-align: center; padding: 50px;">
                        <h2>SECCIÓN DE LISTA</h2>
                        <p>Lista de ásanas aparecerá aquí</p>
                    </div>
                </section>

                <section id="lexicon" class="section">
                    <div style="text-align: center; padding: 50px;">
                        <h2>SECCIÓN LEXICÓN</h2>
                        <p>Contenido del lexicón aparecerá aquí</p>
                    </div>
                </section>

                <section id="lexicon-list" class="section">
                    <div style="text-align: center; padding: 50px;">
                        <h2>SECCIÓN LISTA LEXICÓN</h2>
                        <p>Lista de términos aparecerá aquí</p>
                    </div>
                </section>

                <section id="about" class="section">
                    <div style="text-align: center; padding: 50px;">
                        <h2>ACERCA DE</h2>
                        <p>Información sobre la aplicación</p>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Barra de navegación fija -->
    <div class="nav-bar">
        <div class="nav-menu">
            <button class="nav-btn active" data-section="log">
                <i class="fa-solid fa-book"></i>
                <span>BITÁCORA</span>
            </button>
            <button class="nav-btn" data-section="study">
                <i class="fa-solid fa-graduation-cap"></i>
                <span>ESTUDIO</span>
            </button>
            <button class="nav-btn" data-section="list">
                <i class="fa-solid fa-list"></i>
                <span>LISTA</span>
            </button>
            <button class="nav-btn" data-section="lexicon">
                <i class="fa-solid fa-book-open"></i>
                <span>LEXICÓN</span>
            </button>
            <button class="nav-btn" data-section="lexicon-list">
                <i class="fa-solid fa-list-check"></i>
                <span>LISTA LEXICÓN</span>
            </button>
            <button class="nav-btn" data-section="about">
                <i class="fa-solid fa-circle-info"></i>
                <span>ACERCA DE</span>
            </button>
        </div>
    </div>

    <script>
        // Configuración de Supabase
        const SUPABASE_URL = 'https://edkumnfbwzpeuifbxubp.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVka3VtbmZid3pwZXVpZmJ4dWJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyMDI2NjgsImV4cCI6MjA3Nzc3ODY2OH0.EhiZN_2EVDcQ8LdE-V1T3LknzUDsiya697K3P4kbu5E';
        
        // Inicializar cliente de Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

          const moodOptions = [
            { name: 'feliz', label: 'Mood: YEaYy!!', emoji: '<i class="fa-solid fa-face-laugh-beam"></i>', color: '#2a9d8f' },
            { name: 'enojado', label: 'Mood: Ehhh... hubo días mejores', emoji: '<i class="fa-solid fa-face-meh"></i>', color: '#e9c46a' },
            { name: 'cansancio', label: 'Mood: siesta', emoji: '<i class="fa-solid fa-face-tired"></i>', color: '#bc4749' },
            { name: 'relajado', label: 'Mood: ohmmm', emoji: '<i class="fa-solid fa-heart"></i>', color: '#FF9A76' },
            { name: 'energico', label: 'Mood: estoy para doblete', emoji: '<i class="fa-solid fa-bolt-lightning"></i>', color: '#95E1D3' },
            { name: 'complete', label: 'Práctica Completa', emoji: '<i class="fa-solid fa-check"></i>', color: '#81b29a' },
            { name: 'inconclusa', label: 'Práctica Inconmpleta', emoji: '<i class="fa-solid fa-xmark"></i>', color: '#bc6c25' },
            { name: 'primera', label: 'Primera Serie', emoji: '<i class="fa-solid fa-1"></i>', color: '#da627d' },
            { name: 'segunda', label: 'Segunda Serie', emoji: '<i class="fa-solid fa-2"></i>', color: '#ffa5ab' },
            { name: 'otro estilo', label: 'vinyasa', emoji: '<i class="fa-solid fa-fire"></i>', color: '#a26769' },
            { name: 'moon day', label: 'Moon Day', emoji: '<i class="fa-solid fa-moon"></i>', color: '#ced4da' },
            { name: 'quote', label: 'quote', emoji: '<i class="fa-solid fa-quote-right"></i>', color: '#6d597a' },
            ];

        // Datos de ejemplo para asanas
        const sampleAsanas = [
            { id: 'tadasana', name: 'Tadasana', sanskrit: 'ताडासन', english: 'Mountain Pose' },
            { id: 'adho_mukha_svanasana', name: 'Adho Mukha Svanasana', sanskrit: 'अधो मुख श्वानासन', english: 'Downward-Facing Dog' },
            { id: 'virabhadrasana_i', name: 'Virabhadrasana I', sanskrit: 'वीरभद्रासन I', english: 'Warrior I' },
            { id: 'virabhadrasana_ii', name: 'Virabhadrasana II', sanskrit: 'वीरभद्रासन II', english: 'Warrior II' },
            { id: 'balasana', name: 'Balasana', sanskrit: 'बालासन', english: 'Child\'s Pose' }
        ];

        // Variables globales
        let currentLogEntry = {
            date: new Date(),
            practiced: false,
            moods: [],
            notes: "",
            tags: [],
            asanas: []
        };

        let logHistory = [];
        let selectedMoods = [];
        let currentTags = [];
        let currentAsanas = [];

        // Fecha de inicio para estadísticas (1/11/2025)
        const startDate = new Date(2025, 10, 1); // Noviembre es 10 (0-indexed)

        // Inicialización
        document.addEventListener('DOMContentLoaded', function() {
            initializeLogSection();
            setupEventListeners();
            loadLogHistory();
            setupNavigation();
        });

        // Inicializar la sección de bitácora
        function initializeLogSection() {
            // Establecer fecha actual
            const now = new Date();
            const formattedDate = now.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            document.getElementById('current-date').textContent = `${formattedDate}`;
            
            // Establecer fecha actual como valor por defecto en el campo de fecha
            document.getElementById('practice-date').valueAsDate = now;
            
            // Inicializar mood board
            initializeMoodBoard();
            
            // Inicializar búsqueda de asanas
            initializeAsanaSearch();
        }

        // Inicializar mood board
        function initializeMoodBoard() {
            const moodBoard = document.getElementById('mood-board');
            moodBoard.innerHTML = '';
            
            moodOptions.forEach((mood, index) => {
                const moodItem = document.createElement('div');
                moodItem.className = 'mood-item';
                moodItem.innerHTML = mood.emoji;
                moodItem.title = mood.label;
                moodItem.dataset.index = index;
                moodItem.style.backgroundColor = mood.color;
                
                moodItem.addEventListener('click', function() {
                    toggleMoodSelection(index);
                });
                
                moodBoard.appendChild(moodItem);
            });
        }

        // Alternar selección de mood
        function toggleMoodSelection(index) {
            const moodItem = document.querySelector(`.mood-item[data-index="${index}"]`);
            
            if (selectedMoods.includes(index)) {
                // Deseleccionar
                selectedMoods = selectedMoods.filter(i => i !== index);
                moodItem.classList.remove('selected');
            } else {
                // Seleccionar
                selectedMoods.push(index);
                moodItem.classList.add('selected');
            }
            
            // Actualizar entrada actual
            currentLogEntry.moods = selectedMoods.map(i => moodOptions[i]);
        }

        // Inicializar búsqueda de asanas
        function initializeAsanaSearch() {
            const searchInput = document.getElementById('asana-search-input');
            const searchResults = document.getElementById('asana-search-results');
            
            searchInput.addEventListener('input', function() {
                const query = this.value.toLowerCase().trim();
                
                if (query.length < 2) {
                    searchResults.style.display = 'none';
                    return;
                }
                
                // Filtrar asanas
                const filteredAsanas = sampleAsanas.filter(asana => 
                    asana.name.toLowerCase().includes(query) ||
                    asana.sanskrit.toLowerCase().includes(query) ||
                    asana.english.toLowerCase().includes(query) ||
                    asana.id.toLowerCase().includes(query)
                );
                
                // Mostrar resultados
                displayAsanaSearchResults(filteredAsanas, searchResults);
            });
        }

        // Mostrar resultados de búsqueda de asanas
        function displayAsanaSearchResults(asanas, container) {
            if (asanas.length === 0) {
                container.innerHTML = '<div class="asana-search-result">No se encontraron āsanas</div>';
                container.style.display = 'block';
                return;
            }
            
            container.innerHTML = '';
            
            asanas.forEach(asana => {
                const result = document.createElement('div');
                result.className = 'asana-search-result';
                result.innerHTML = `
                    <strong>${asana.name}</strong> (${asana.sanskrit})<br>
                    <small>${asana.english} - ID: ${asana.id}</small>
                `;
                
                result.addEventListener('click', function() {
                    addAsanaToLog(asana);
                    document.getElementById('asana-search-input').value = '';
                    container.style.display = 'none';
                });
                
                container.appendChild(result);
            });
            
            container.style.display = 'block';
        }

        // Añadir asana a la entrada actual
        function addAsanaToLog(asana) {
            if (!currentAsanas.some(a => a.id === asana.id)) {
                currentAsanas.push(asana);
                updateAsanasDisplay();
            }
        }

        // Actualizar visualización de asanas
        function updateAsanasDisplay() {
            const asanasList = document.getElementById('asanas-list');
            asanasList.innerHTML = '';
            
            currentAsanas.forEach((asana, index) => {
                const asanaElement = document.createElement('span');
                asanaElement.className = 'asana-tag';
                asanaElement.textContent = asana.name;
                
                const removeBtn = document.createElement('span');
                removeBtn.innerHTML = ' &times;';
                removeBtn.style.cursor = 'pointer';
                removeBtn.style.marginLeft = '5px';
                removeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    currentAsanas.splice(index, 1);
                    updateAsanasDisplay();
                });
                
                asanaElement.appendChild(removeBtn);
                asanasList.appendChild(asanaElement);
            });
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Toggle de práctica
            document.getElementById('practice-button').addEventListener('click', function() {
                this.classList.toggle('yes');
                const practiceState = this.querySelector('.practice-state');
                currentLogEntry.practiced = this.classList.contains('yes');
                practiceState.textContent = currentLogEntry.practiced ? 'SÍ' : 'NO';
            });

            // Añadir tag
            document.getElementById('add-tag-btn').addEventListener('click', function() {
                const tagInput = document.getElementById('tag-input');
                const tagText = tagInput.value.trim();
                
                if (tagText && !currentTags.includes(tagText)) {
                    currentTags.push(tagText);
                    updateTagsDisplay();
                    tagInput.value = '';
                }
            });

            // Añadir asana manualmente
            document.getElementById('add-asana-btn').addEventListener('click', function() {
                const asanaInput = document.getElementById('asana-search-input');
                const asanaText = asanaInput.value.trim();
                
                if (asanaText) {
                    const customAsana = {
                        id: 'custom_' + Date.now(),
                        name: asanaText,
                        sanskrit: '',
                        english: ''
                    };
                    
                    addAsanaToLog(customAsana);
                    asanaInput.value = '';
                }
            });

            // Guardar entrada
            document.getElementById('save-log-btn').addEventListener('click', function() {
                saveLogEntry();
            });

            // Limpiar entrada actual
            document.getElementById('clear-log-btn').addEventListener('click', function() {
                clearCurrentEntry();
            });
        }

        // Configurar navegación
        function setupNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetSection = this.getAttribute('data-section');
                    
                    // Actualizar botones activos
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Mostrar sección correspondiente
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(targetSection).classList.add('active');
                });
            });
        }


        // Mostrar historial de entradas
        function displayLogHistory() {
            const logHistoryContainer = document.getElementById('log-history');
            
            // Mostrar todas las entradas (sin filtros)
            let filteredHistory = [...logHistory];
            
            // Generar HTML para las entradas
            if (filteredHistory.length === 0) {
                logHistoryContainer.innerHTML = '<p style="text-align: center;">No hay entradas en el historial</p>';
                return;
            }
            
            let historyHTML = '<h3>HISTORIAL de prácticas</h3>';
            
            filteredHistory.forEach(entry => {
                // Formatear fecha completa
                const formattedDate = entry.date.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
                });
                
                // Botón SÍ/NO como un mood más
                const practiceButtonHTML = `
                    <div class="log-entry-practice ${entry.practiced ? 'yes' : ''}">
                        <div class="practice-state">${entry.practiced ? 'SÍ' : 'NO'}</div>
                    </div>
                `;
                
                // Moods seleccionados
                const moodsHTML = entry.moods.map(mood => 
                    `<div class="log-entry-mood" style="background-color: ${mood.color}">${mood.emoji}</div>`
                ).join('');
                
                const tagsHTML = entry.tags.map(tag => 
                    `<span class="log-entry-tag">${tag}</span>`
                ).join('');
                
                const asanasHTML = entry.asanas.map(asana => 
                    `<span class="log-entry-tag">${asana.name}</span>`
                ).join('');
                
                historyHTML += `
                    <div class="log-entry" data-id="${entry.id}">
                        <div class="log-entry-header">
                            <div class="log-entry-date">${formattedDate}</div>
                            <div class="log-entry-moods">
                                ${practiceButtonHTML}
                                ${moodsHTML}
                            </div>
                        </div>
                        ${tagsHTML ? `<div class="log-entry-tags">${tagsHTML}</div>` : ''}
                        ${asanasHTML ? `<div class="log-entry-tags">${asanasHTML}</div>` : ''}
                        ${entry.notes ? `<div class="log-entry-notes">${entry.notes}</div>` : ''}
                        <button class="delete-entry-btn" data-id="${entry.id}">Eliminar</button>
                    </div>
                `;
            });
            
            logHistoryContainer.innerHTML = historyHTML;
            
            // Añadir event listeners para los botones de eliminar
            document.querySelectorAll('.delete-entry-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const entryId = this.getAttribute('data-id');
                    if (confirm('¿Estás seguro de que quieres eliminar esta entrada?')) {
                        deleteEntryById(entryId);
                    }
                });
            });
        }

        // Eliminar entrada por ID
        async function deleteEntryById(entryId) {
            try {
                // Eliminar de Supabase
                const { error } = await supabase
                    .from('log_entries')
                    .delete()
                    .eq('id', entryId);

                if (error) throw error;
                
                // Eliminar del historial local
                logHistory = logHistory.filter(entry => entry.id !== entryId);
                
                // Actualizar visualización
                displayLogHistory();
                updateStatistics();
                
                alert('Entrada eliminada correctamente');
                
            } catch (error) {
                console.error('Error al eliminar en Supabase:', error);
                alert('Error al eliminar: ' + error.message);
            }
        }

// Guardar entrada de bitácora
async function saveLogEntry() {
    // Obtener fecha del campo de entrada o usar la actual
    const dateInput = document.getElementById('practice-date').value;
    let entryDate;
    
    if (dateInput) {
        // Crear fecha sin problemas de huso horario
        const [year, month, day] = dateInput.split('-');
        entryDate = new Date(year, month - 1, day); // month - 1 porque los meses en JS son 0-indexed
    } else {
        // Usar fecha actual, pero normalizada a medianoche para evitar problemas
        const now = new Date();
        entryDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    }
    
    // Actualizar datos de la entrada actual
    currentLogEntry.date = entryDate;
    currentLogEntry.notes = document.getElementById('practice-notes').value;
    currentLogEntry.tags = [...currentTags];
    currentLogEntry.asanas = [...currentAsanas];
    
    // Guardar en Supabase
    try {
        const entryData = {
            date: currentLogEntry.date.toISOString(),
            practiced: currentLogEntry.practiced,
            moods: currentLogEntry.moods,
            notes: currentLogEntry.notes,
            tags: currentLogEntry.tags,
            asanas: currentLogEntry.asanas
        };
        
        const { data, error } = await supabase
            .from('log_entries')
            .upsert([entryData]);

        if (error) throw error;
        
        console.log('Entrada guardada en Supabase:', data);
        
        // Crear nueva entrada
        const newEntry = {
            id: Date.now().toString(),
            ...currentLogEntry
        };
        logHistory.unshift(newEntry);
        
        // Actualizar visualización
        displayLogHistory();
        updateStatistics();
        clearCurrentEntry();
        
        alert('Entrada guardada correctamente');
        
    } catch (error) {
        console.error('Error al guardar en Supabase:', error);
        alert('Error al guardar: ' + error.message);
    }
}

// Cargar historial desde Supabase
async function loadLogHistory() {
    try {
        const { data, error } = await supabase
            .from('log_entries')
            .select('*')
            .order('date', { ascending: false });
        
        if (error) throw error;
        
        if (data) {
            logHistory = data.map(entry => {
                // Crear fecha sin problemas de huso horario
                const dateFromDB = new Date(entry.date);
                const normalizedDate = new Date(
                    dateFromDB.getFullYear(),
                    dateFromDB.getMonth(),
                    dateFromDB.getDate()
                );
                
                return {
                    ...entry,
                    date: normalizedDate
                };
            });
            displayLogHistory();
            updateStatistics();
        }
    } catch (error) {
        console.error('Error al cargar desde Supabase:', error);
    }
}

// Actualizar estadísticas
function updateStatistics() {
    const today = new Date();
    const statsSummary = document.getElementById('stats-summary');
    const statsChart = document.getElementById('stats-chart');
    
    // Normalizar fecha de hoy a medianoche para comparaciones
    const normalizedToday = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    
    // Filtrar entradas desde el 1/11/2025 que sean días laborables (lunes a viernes)
    const filteredEntries = logHistory.filter(entry => {
        const dayOfWeek = entry.date.getDay(); // 0 = domingo, 1 = lunes, ..., 6 = sábado
        const isWeekday = dayOfWeek >= 1 && dayOfWeek <= 5; // lunes a viernes
        return entry.date >= startDate && entry.practiced && isWeekday;
    });
    
    // Calcular días laborables desde el 1/11/2025 hasta hoy
    let weekdaysSinceStart = 0;
    let currentDate = new Date(startDate);
    
    while (currentDate <= normalizedToday) {
        const dayOfWeek = currentDate.getDay();
        if (dayOfWeek >= 1 && dayOfWeek <= 5) { // lunes a viernes
            weekdaysSinceStart++;
        }
        currentDate.setDate(currentDate.getDate() + 1);
    }
    
    // Calcular estadísticas
    const practiceCount = filteredEntries.length;
    const practiceRatio = weekdaysSinceStart > 0 ? (practiceCount / weekdaysSinceStart) * 100 : 0;
    
    // Actualizar resumen
    statsSummary.innerHTML = `
        <strong>${practiceCount}/${weekdaysSinceStart} días de práctica - ${practiceRatio.toFixed(1)}%</strong>
        <br><i><div style="font-size: 0.8rem; color: #333;">desde 1/11/2025 (solo días laborables)</div>
    `;
    
    // Generar datos para el gráfico (frecuencia de moods)
    const moodFrequencyData = getMoodFrequencyData();
    
    // Limpiar gráfico
    statsChart.innerHTML = '';
    
    // Crear barras del gráfico
    moodFrequencyData.forEach(data => {
        const maxFrequency = Math.max(...moodFrequencyData.map(d => d.count));
        const barHeight = maxFrequency > 0 ? (data.count / maxFrequency) * 100 : 0;
        
        const bar = document.createElement('div');
        bar.className = 'chart-bar';
        bar.style.height = `${barHeight}%`;
        bar.style.backgroundColor = data.color;
        
        const value = document.createElement('div');
        value.className = 'chart-value';
        value.textContent = data.count;
        
        const label = document.createElement('div');
        label.className = 'chart-label';
        
        // Crear el círculo con el emoji y color de fondo
        const moodCircle = document.createElement('div');
        moodCircle.className = 'chart-mood-circle';
        moodCircle.innerHTML = data.emoji;
        moodCircle.style.backgroundColor = data.color;
        moodCircle.title = data.label;
        
        label.appendChild(moodCircle);
        bar.appendChild(value);
        bar.appendChild(label);
        statsChart.appendChild(bar);
    });
}

// Limpiar entrada actual
function clearCurrentEntry() {
    // Restablecer práctica
    document.getElementById('practice-button').classList.remove('yes');
    document.querySelector('.practice-state').textContent = 'NO';
    currentLogEntry.practiced = false;
    
    // Limpiar moods
    selectedMoods = [];
    document.querySelectorAll('.mood-item').forEach(item => {
        item.classList.remove('selected');
    });
    currentLogEntry.moods = [];
    
    // Limpiar fecha (establecer a hoy) - normalizada
    const now = new Date();
    const normalizedNow = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    document.getElementById('practice-date').valueAsDate = normalizedNow;
    
    // Limpiar notas
    document.getElementById('practice-notes').value = '';
    currentLogEntry.notes = '';
    
    // Limpiar tags
    currentTags = [];
    updateTagsDisplay();
    currentLogEntry.tags = [];
    
    // Limpiar asanas
    currentAsanas = [];
    updateAsanasDisplay();
    currentLogEntry.asanas = [];
    
    // Restablecer fecha en el header
    const formattedDate = normalizedNow.toLocaleDateString('es-ES', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
    });
    document.getElementById('current-date').textContent = `${formattedDate}`;
}


        // Obtener frecuencia de moods
        function getMoodFrequencyData() {
            const moodCounts = {};
            
            // Inicializar contadores para todos los moods
            moodOptions.forEach(mood => {
                moodCounts[mood.name] = {
                    label: mood.label,
                    count: 0,
                    color: mood.color,
                    emoji: mood.emoji // Añadir el emoji para mostrarlo en el gráfico
                };
            });
            
            // Contar frecuencia de cada mood en todas las entradas
            logHistory.forEach(entry => {
                if (entry.moods && Array.isArray(entry.moods)) {
                    entry.moods.forEach(mood => {
                        if (moodCounts[mood.name]) {
                            moodCounts[mood.name].count++;
                        }
                    });
                }
            });
            
            // Convertir a array y ordenar por frecuencia (mayor a menor)
            const moodFrequencyData = Object.values(moodCounts)
                .filter(mood => mood.count > 0)
                .sort((a, b) => b.count - a.count);
            
            return moodFrequencyData;
        }


        // Actualizar visualización de tags
        function updateTagsDisplay() {
            const tagsList = document.getElementById('tags-list');
            tagsList.innerHTML = '';
            
            currentTags.forEach((tag, index) => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                
                const removeBtn = document.createElement('span');
                removeBtn.innerHTML = ' &times;';
                removeBtn.style.cursor = 'pointer';
                removeBtn.style.marginLeft = '5px';
                removeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    currentTags.splice(index, 1);
                    updateTagsDisplay();
                });
                
                tagElement.appendChild(removeBtn);
                tagsList.appendChild(tagElement);
            });
        }

        // Limpiar entrada actual
        function clearCurrentEntry() {
            // Restablecer práctica
            document.getElementById('practice-button').classList.remove('yes');
            document.querySelector('.practice-state').textContent = 'NO';
            currentLogEntry.practiced = false;
            
            // Limpiar moods
            selectedMoods = [];
            document.querySelectorAll('.mood-item').forEach(item => {
                item.classList.remove('selected');
            });
            currentLogEntry.moods = [];
            
            // Limpiar fecha (establecer a hoy)
            document.getElementById('practice-date').valueAsDate = new Date();
            
            // Limpiar notas
            document.getElementById('practice-notes').value = '';
            currentLogEntry.notes = '';
            
            // Limpiar tags
            currentTags = [];
            updateTagsDisplay();
            currentLogEntry.tags = [];
            
            // Limpiar asanas
            currentAsanas = [];
            updateAsanasDisplay();
            currentLogEntry.asanas = [];
            
            // Restablecer fecha en el header
            const now = new Date();
            const formattedDate = now.toLocaleDateString('es-ES', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            document.getElementById('current-date').textContent = `${formattedDate}`;
        }
    </script>
</body>
</html>
